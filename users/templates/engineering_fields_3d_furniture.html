{% extends "base.html" %}
{% load static %}
<link rel="stylesheet" href="{% static 'style/style.css' %}">

{% block title %}Engineering Fields - Build from Scratch{% endblock %}

{% block content %}
<div class="container py-5">
<h2 class="mb-4">Engineering Fields for 3d</h2>

    {% comment %} ===== Interior Design Carousel ===== {% endcomment %}
    <div class="card h-100 shadow-sm specialization-carousel" data-specialization="interior">
      <div class="card-body">
        <h5 class="card-title mb-3">Interior Design</h5>
        <div class="position-relative">
          <button class="btn btn-outline-secondary btn-sm position-absolute top-50 start-0 translate-middle-y" type="button" onclick="scrollEngineers('interior-carousel', -1)">&lt;</button>
          <div id="interior-carousel" class="d-flex flex-row flex-nowrap overflow-auto gap-3 px-5">
            {% for engineer in interior_engineers %}
            <div class="card engineer-card" data-bs-toggle="modal" data-bs-target="#interiorEngineerModal{{ engineer.eng_id }}">
              <img src="{% if engineer.profile_photo %}{{ engineer.profile_photo.url }}{% else %}/static/images/default-engineer.png{% endif %}" class="card-img-top" alt="Engineer Photo" style="height:120px;object-fit:cover;">
              <div class="card-body text-center">
                <h6 class="card-title mb-1">{{ engineer.user.first_name }} {{ engineer.user.last_name }}</h6>
                <p class="card-text small text-muted">{{ engineer.user.email }}</p>
              </div>
            </div>
            <!-- Modal -->
            <div class="modal fade" id="interiorEngineerModal{{ engineer.eng_id }}" tabindex="-1" aria-labelledby="interiorEngineerModalLabel{{ engineer.eng_id }}" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="interiorEngineerModalLabel{{ engineer.eng_id }}">{{ engineer.user.first_name }} {{ engineer.user.last_name }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <img src="{% if engineer.profile_photo %}{{ engineer.profile_photo.url }}{% else %}/static/images/default-engineer.png{% endif %}" class="img-fluid rounded mb-3" alt="Engineer Photo">
                    <p><strong>Email:</strong> {{ engineer.user.email }}</p><a href="{% url 'engineer_detail' engineer.eng_id %}" class="btn btn-primary engineer-btn w-100 ms-2">View Engineer Profile</a>
                    <p><strong>Specialty:</strong> {{ engineer.specialization|title }}</p>
                    <form method="post" action="/book-session/" enctype="multipart/form-data">
                      {% csrf_token %}
              
                      <div class="mb-3">
                        <label for="customerFilesInt{{ engineer.eng_id }}" class="form-label">Upload Files/Images</label>
                        <input type="file" class="form-control" id="customerFilesInt{{ engineer.eng_id }}" name="customer_files" multiple>
                      </div>
                      <div class="mb-3">
                        <label for="projectDescription{{ engineer.eng_id }}" class="form-label">Project Description</label>
                        <textarea class="form-control" id="projectDescription{{ engineer.eng_id }}" name="project_description" rows="4" placeholder="Describe your project..." required></textarea>
                      </div>
                      <input type="hidden" name="engineer_id" value="{{ engineer.eng_id }}">
                      <button type="submit" class="btn btn-primary w-100">Send to Engineer</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            {% empty %}
            <div class="text-muted">No interior design engineers available.</div>
            {% endfor %}
          </div>
          <script>document.getElementById('interior-carousel').dataset.startIdx = 0;</script>
          <button class="slider-btn position-absolute top-50 end-0 translate-middle-y" type="button" onclick="scrollEngineers('interior-carousel', 1)">&gt;</button>
        </div>
      </div>
    </div>

  </div>
</div>
    
<script>
  // Filter function
  function filterBySpecialization() {
    const selected = document.getElementById('specializationSelect').value;
    const carousels = document.querySelectorAll('.specialization-carousel');
    carousels.forEach(carousel => {
      if (selected === 'all' || carousel.dataset.specialization === selected) {
        carousel.style.display = 'block';
      } else {
        carousel.style.display = 'none';
      }
    });
  }

  // Initialize sliders and filter
  document.addEventListener('DOMContentLoaded', function() {
    filterBySpecialization();
    ['architecture-carousel','civil-carousel','mechanical-carousel','interior-carousel'].forEach(function(id){
      if(document.getElementById(id)) showEngineers(id, 0, 6);
    });
  });

  // Existing slider functions (keep as-is)
  function showEngineers(carouselId, startIdx, visibleCount) {
    const carousel = document.getElementById(carouselId);
    const cards = carousel.querySelectorAll('.engineer-card');
    cards.forEach((card, idx) => {
      card.style.display = (idx >= startIdx && idx < startIdx + visibleCount) ? 'flex' : 'none';
    });
    carousel.dataset.startIdx = startIdx;
  }
  function scrollEngineers(carouselId, direction) {
    const carousel = document.getElementById(carouselId);
    const cards = carousel.querySelectorAll('.engineer-card');
    const visibleCount = 3;
    let startIdx = parseInt(carousel.dataset.startIdx || '0');
    startIdx += direction * visibleCount;
    if (startIdx < 0) startIdx = 0;
    if (startIdx > cards.length - visibleCount) startIdx = Math.max(cards.length - visibleCount, 0);
    showEngineers(carouselId, startIdx, visibleCount);
  }
</script>

{% endblock %}