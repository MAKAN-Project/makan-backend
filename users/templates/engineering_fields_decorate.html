{% extends "base.html" %}
{% load static %}
<link rel="stylesheet" href="{% static 'style/style.css' %}">

{% block title %}Engineering Fields - Decorate & Redecorate{% endblock %}

{% block content %}
<div class="container py-5">
  <script>
    function showEngineers(carouselId, startIdx, visibleCount) {
      const carousel = document.getElementById(carouselId);
      const cards = carousel.querySelectorAll('.engineer-card');
      cards.forEach((card, idx) => {
        card.style.display = (idx >= startIdx && idx < startIdx + visibleCount) ? 'flex' : 'none';
      });
      carousel.dataset.startIdx = startIdx;
    }
    function scrollEngineers(carouselId, direction) {
      const carousel = document.getElementById(carouselId);
      const cards = carousel.querySelectorAll('.engineer-card');
      const visibleCount = 3;
      let startIdx = parseInt(carousel.dataset.startIdx || '0');
      startIdx += direction * visibleCount;
      if (startIdx < 0) startIdx = 0;
      if (startIdx > cards.length - visibleCount) startIdx = Math.max(cards.length - visibleCount, 0);
      showEngineers(carouselId, startIdx, visibleCount);
    }
    document.addEventListener('DOMContentLoaded', function() {
      ['interior-carousel'].forEach(function(id){
        if(document.getElementById(id)) showEngineers(id, 0, 3);
      });
    });
  </script>
  <h2 class="mb-4">Engineering Fields for Decorate & Redecorate</h2>
  <div class="d-flex flex-column gap-4">
    <!-- Interior Design Field -->
    <div class="card h-100 shadow-sm">
      <div class="card-body">
        <h5 class="card-title mb-3">Interior Design</h5>
        <div class="position-relative">
          <button class="btn btn-outline-secondary btn-sm position-absolute top-50 start-0 translate-middle-y" type="button" onclick="scrollEngineers('interior-carousel', -1)">&lt;</button>
          <div id="interior-carousel" class="d-flex flex-row flex-nowrap overflow-auto gap-3 px-5">
            {% for engineer in interior_engineers %}
            <div class="card engineer-card" data-bs-toggle="modal" data-bs-target="#interiorEngineerModal{{ engineer.id }}">
              <img src="{{ engineer.image_url|default:'/static/images/default-engineer.png' }}" class="card-img-top" alt="Engineer Photo" style="height:120px;object-fit:cover;">
              <div class="card-body text-center">
                <h6 class="card-title mb-1">{{ engineer.user.first_name }} {{ engineer.user.last_name }}</h6>
                <p class="card-text small text-muted">{{ engineer.user.email }}</p>
              </div>
            </div>
            <!-- Engineer Modal -->
            <div class="modal fade" id="interiorEngineerModal{{ engineer.id }}" tabindex="-1" aria-labelledby="interiorEngineerModalLabel{{ engineer.id }}" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="interiorEngineerModalLabel{{ engineer.id }}">{{ engineer.user.first_name }} {{ engineer.user.last_name }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <img src="{{ engineer.image_url|default:'/static/images/default-engineer.png' }}" class="img-fluid rounded mb-3" alt="Engineer Photo">
                    <p><strong>Email:</strong> {{ engineer.user.email }}</p>
                    <p><strong>Specialty:</strong> {{ engineer.specialty|default:'Interior Design' }}</p>
                    <form method="post" action="/book-session/" enctype="multipart/form-data">
                      {% csrf_token %}
                      <div class="mb-3">
                        <label for="sessionDateInt{{ engineer.id }}" class="form-label">Book a Session</label>
                        <input type="datetime-local" class="form-control" id="sessionDateInt{{ engineer.id }}" name="session_date" required>
                      </div>
                      <div class="mb-3">
                        <label for="customerFilesInt{{ engineer.id }}" class="form-label">Upload Files/Images</label>
                        <input type="file" class="form-control" id="customerFilesInt{{ engineer.id }}" name="customer_files" multiple>
                      </div>
                      <input type="hidden" name="engineer_id" value="{{ engineer.id }}">
                      <button type="submit" class="btn btn-primary w-100">Send to Engineer</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            {% empty %}
            <div class="text-muted">No interior design engineers available.</div>
            {% endfor %}
          </div>
          <script>document.getElementById('interior-carousel').dataset.startIdx = 0;</script>
          </div>
          <button class="btn btn-outline-secondary btn-sm position-absolute top-50 end-0 translate-middle-y" type="button" onclick="scrollEngineers('interior-carousel', 1)">&gt;</button>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
