{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Makan{% endblock %}</title>

  <!-- Bootstrap CSS & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Main CSS -->
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <!-- Small overrides loaded last to neutralize vendor themes if present -->
  <link rel="stylesheet" href="{% static 'css/override.css' %}">

  {% block extra_head %}{% endblock %}
</head>
<body>

<!-- ===== NAVBAR ===== -->
<nav  id="mainNavbar" class="navbar navbar-expand-lg fixed-top shadow-sm py-3">
  <div class="container">
    <!-- Logo -->
   <a class="navbar-brand d-flex align-items-center" href="#">
      <img src="{% static 'images/logo.png' %}" alt="MAKAN Logo" class="me-2">
    </a>

    <!-- Mobile Toggle -->
    <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu"
      aria-controls="navMenu" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Navbar Links -->
    <div class="collapse navbar-collapse" id="navMenu">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-lg-center">
        <!-- Main Links -->
        <li class="nav-item"><a class="nav-link fw-semibold text-dark px-3" href="#">Home</a></li>
        <li class="nav-item"><a class="nav-link fw-semibold text-dark px-3" href="#">Projects</a></li>
        <li class="nav-item"><a class="nav-link fw-semibold text-dark px-3" href="#">Engineers</a></li>
        <li class="nav-item"><a class="nav-link fw-semibold text-dark px-3" href="#">AI Studio</a></li>
        <li class="nav-item"><a class="nav-link fw-semibold text-dark px-3" href="#">About</a></li>

        <!-- Notifications -->
        <li class="nav-item dropdown ms-lg-3">
          <button class="btn btn-light position-relative rounded-circle p-2" id="notifBtn" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-bell fs-5"></i>
            {% if pending_notifications %}
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger border border-light">
                {{ pending_notifications|length }}
              </span>
            {% endif %}
          </button>
          <ul class="dropdown-menu dropdown-menu-end shadow-lg" aria-labelledby="notifBtn" style="min-width: 300px;">
            {% if pending_notifications %}
              {% for notif in pending_notifications %}
                <li class="p-3 border-bottom d-flex justify-content-between align-items-start">
                  <div>
                    <div class="fw-semibold">{{ notif.client.first_name }} {{ notif.client.last_name }}</div>
                    <small class="text-muted">{{ notif.created_at|date:"Y-m-d H:i" }}</small>
                  </div>
                  <button class="btn btn-sm btn-outline-primary view-request-btn"
                    data-bs-toggle="modal" data-bs-target="#requestModal"
                    data-request-id="{{ notif.request_id }}"
                    data-description="{{ notif.description }}"
                    data-client="{{ notif.client.first_name }} {{ notif.client.last_name }}"
                    {% if notif.file %} data-file-url="/media/{{ notif.file.path }}" data-file-name="{{ notif.file.file_name }}" {% endif %}>
                    View
                  </button>
                </li>
              {% endfor %}
            {% else %}
              <li class="p-3 text-center text-muted">No new notifications</li>
            {% endif %}
          </ul>
        </li>

        <!-- User Dropdown -->
        <li class="nav-item dropdown ms-lg-3">
          <button class="btn btn-light rounded-circle p-2" id="userBtn" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-person-circle fs-5"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end shadow-sm">
            <li><a class="dropdown-item" href="#">Profile</a></li>
            <li><a class="dropdown-item" href="#">Settings</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="{% url 'logout_user' %}">Logout</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>


<!-- ===== MAIN CONTENT ===== -->
<main class="mt-6 pt-5" style="margin-top: 90px;">
  {% block content %}{% endblock %}
</main>

<!-- ===== MODAL ===== -->
<div class="modal fade" id="requestModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content rounded-4 shadow-lg">
      <form method="POST" id="requestActionForm">{% csrf_token %}
        <div class="modal-header bg-primary text-light rounded-top">
          <h5 class="modal-title">Project Request Details</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p><strong>Client:</strong> <span id="modalClient"></span></p>
          <p><strong>Request ID:</strong> <span id="modalRequestId"></span></p>

          <div class="mb-3">
            <strong>Description:</strong>
            <div id="modalDescription" class="p-3 bg-light rounded"></div>
          </div>

          <div id="modalFileContainer" class="mt-3 d-none">
            <strong>Attached File:</strong>
            <p id="modalFile"></p>
          </div>

          <div class="mt-3">
            <label for="scheduled_at" class="form-label">Session Date & Time</label>
            <input id="scheduled_at" name="scheduled_at" type="datetime-local" required class="form-control">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">Close</button>
          <button type="submit" id="acceptBtn" formaction="" class="btn btn-success rounded-pill">Accept & Schedule</button>
          <button type="submit" id="rejectBtn" formaction="" class="btn btn-danger rounded-pill">Reject</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ===== FOOTER ===== -->
<!-- ===== FOOTER ===== -->

<footer class="site-footer">
  <div class="container py-5">
    <div class="row gy-4">
      
      <!-- Logo & About -->
      <div class="col-md-4">
      <a href="home.html"><h2 class="footer-brand mb-3">MAKAN</h2></a>
        <p class="footer-text">
          MAKAN is a platform connecting clients with professional engineers, 
          providing innovative architecture and interior design solutions powered by AI and 3D technology.
        </p>
      </div>

      <!-- Quick Links -->
      <div class="col-md-4">
        <h5 class="footer-title">Quick Links</h5>
        <ul class="footer-links list-unstyled">
          <li><a href="#">Home</a></li>
          <li><a href="#">Our Services</a></li>
          <li><a href="#">Portfolio</a></li>
          <li><a href="#">About Us</a></li>
          <li><a href="#">Contact</a></li>
        </ul>
      </div>

      <!-- Contact & Social -->
      <div class="col-md-4">
        <h5 class="footer-title">Contact</h5>
        <p class="footer-text mb-2">ðŸ“§ info@makan.com</p>
        <p class="footer-text mb-4">ðŸ“ž +972 599 000 000</p>
        <div class="social-icons">
          <a href="#"><i class="bi bi-facebook"></i></a>
          <a href="#"><i class="bi bi-instagram"></i></a>
          <a href="#"><i class="bi bi-linkedin"></i></a>
          <a href="#"><i class="bi bi-twitter"></i></a>
        </div>
      </div>

    </div>

    <hr class="footer-divider my-4">

    <div class="text-center footer-bottom">
      <p class="mb-0">&copy; 2025 <span class="text-accent">MAKAN</span>. All Rights Reserved.</p>
    </div>
  </div>
</footer>
<!-- ===== SCRIPTS ===== -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Unified scripts: modal population + navbar scroll + logo swap
  (function () {
    // Modal populate dynamically
    document.querySelectorAll('.view-request-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const requestId = btn.dataset.requestId;
        const description = btn.dataset.description;
        const client = btn.dataset.client;
        const fileUrl = btn.dataset.fileUrl;
        const fileName = btn.dataset.fileName;

        document.getElementById('modalRequestId').textContent = requestId;
        document.getElementById('modalDescription').textContent = description;
        document.getElementById('modalClient').textContent = client;

        const fileContainer = document.getElementById('modalFileContainer');
        const fileElement = document.getElementById('modalFile');
        if (fileUrl) {
          fileContainer.classList.remove('d-none');
          fileElement.innerHTML = `<a href="${fileUrl}" target="_blank">${fileName || 'View File'}</a>`;
        } else {
          fileContainer.classList.add('d-none');
          fileElement.innerHTML = '';
        }
      });
    });

    // Navbar scroll effect + logo swap
    const navbar = document.getElementById('mainNavbar');
    const logo = document.getElementById('siteLogo');

    // Helper to set logo based on state
    function setLogo(isScrolled) {
      if (!logo) return;
      const light = logo.dataset.lightSrc;
      const dark = logo.dataset.darkSrc;
      logo.src = isScrolled ? dark : light;
    }

    function onScroll() {
      const scrolled = window.scrollY > 50;
      if (scrolled) {
        navbar.classList.add('scrolled');
        navbar.classList.remove('transparent');
      } else {
        navbar.classList.remove('scrolled');
        // keep transparent only on pages that request it via .transparent class
        if (navbar.dataset.allowTransparent === 'true') {
          navbar.classList.add('transparent');
        }
      }
      setLogo(scrolled);
    }

    // If on the homepage we want transparent navbar at top, mark it here.
    // You can set data-allow-transparent="true" server-side for pages that need it.
    if (window.location.pathname === '/' || window.location.pathname.endsWith('/home')) {
      navbar.dataset.allowTransparent = 'true';
      navbar.classList.add('transparent');
      setLogo(false);
    }

    window.addEventListener('scroll', onScroll);
    // initial run
    onScroll();
  })();
</script>
</body>
</html>
